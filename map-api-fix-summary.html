<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¯å£åœ°å›¾å’Œèˆ¹èˆ¶è·Ÿè¸ªAPIä¿®å¤æ€»ç»“</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; line-height: 1.6; margin: 40px; background: #f8f9fa; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; margin-bottom: 30px; }
        h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; }
        h3 { color: #7f8c8d; margin-top: 20px; margin-bottom: 10px; }
        .problem { background: #ffebee; border-left: 4px solid #f44336; padding: 15px; margin: 15px 0; }
        .solution { background: #e8f5e8; border-left: 4px solid #4caf50; padding: 15px; margin: 15px 0; }
        .warning { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 15px 0; }
        .info { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 15px 0; }
        .code { background: #f4f4f4; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin: 10px 0; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; }
        .highlight { background: #fff3cd; padding: 2px 4px; border-radius: 3px; }
        ul li { margin: 8px 0; }
        .status-ok { color: #4caf50; font-weight: bold; }
        .status-error { color: #f44336; font-weight: bold; }
        .status-warning { color: #ff9800; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f2f2f2; font-weight: bold; }
        .comparison { display: flex; gap: 20px; margin: 20px 0; }
        .before, .after { flex: 1; padding: 15px; border-radius: 5px; }
        .before { background: #ffebee; border: 1px solid #f44336; }
        .after { background: #e8f5e8; border: 1px solid #4caf50; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ æ¸¯å£åœ°å›¾å’Œèˆ¹èˆ¶è·Ÿè¸ªAPIä¿®å¤æ€»ç»“</h1>
        
        <div class="problem">
            <h2>ğŸ” é—®é¢˜æè¿°</h2>
            <p>ç”¨æˆ·åæ˜ <strong>æ¸¯å£åœ°å›¾å’Œèˆ¹èˆ¶è·Ÿè¸ªåŠŸèƒ½ä¸èƒ½è·å–æ¸¯å£åˆ—è¡¨å’Œèˆ¹èˆ¶åˆ—è¡¨</strong>ï¼Œé¡µé¢æ˜¾ç¤ºç©ºç™½æˆ–åŠ è½½å¤±è´¥ã€‚</p>
        </div>

        <h2>ğŸ§ é—®é¢˜åˆ†æ</h2>
        
        <h3>1. åˆæ­¥æ£€æŸ¥</h3>
        <ul>
            <li>å‰ç«¯é¡µé¢å·²ä¿®æ”¹ä¸ºä½¿ç”¨çœŸå®APIï¼ˆgetAllPorts()å’ŒgetAllShips()ï¼‰</li>
            <li>APIè°ƒç”¨è¿”å›404é”™è¯¯</li>
            <li>åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼ŒControlleré…ç½®æ­£ç¡®</li>
        </ul>

        <h3>2. æ ¹æœ¬åŸå› </h3>
        <div class="warning">
            <strong>APIè·¯å¾„å†²çªï¼š</strong>Viteä»£ç†é…ç½®ä¸åç«¯context-pathè®¾ç½®äº§ç”Ÿå†²çªï¼Œå¯¼è‡´APIè·¯å¾„é‡å¤
        </div>

        <table>
            <tr>
                <th>ç»„ä»¶</th>
                <th>é…ç½®</th>
                <th>è¯´æ˜</th>
            </tr>
            <tr>
                <td>åç«¯</td>
                <td><code>context-path: /api</code></td>
                <td>æ‰€æœ‰APIéƒ½æœ‰/apiå‰ç¼€</td>
            </tr>
            <tr>
                <td>å‰ç«¯</td>
                <td><code>baseURL: '/api'</code></td>
                <td>è¯·æ±‚ä¼šè‡ªåŠ¨æ·»åŠ /apiå‰ç¼€</td>
            </tr>
            <tr>
                <td>Viteä»£ç†</td>
                <td><code>'/api' â†’ 'http://localhost:8080'</code></td>
                <td>ç›´æ¥è½¬å‘ï¼Œæ²¡æœ‰é‡å†™è§„åˆ™</td>
            </tr>
        </table>

        <h3>3. è·¯å¾„è¿½è¸ª</h3>
        <div class="comparison">
            <div class="before">
                <h4>âŒ é”™è¯¯çš„è¯·æ±‚æµç¨‹</h4>
                <ol>
                    <li>å‰ç«¯è°ƒç”¨: <code>/ports/all</code></li>
                    <li>æ·»åŠ baseURL: <code>/api/ports/all</code></li>
                    <li>Viteä»£ç†è½¬å‘: <code>http://localhost:8080/api/ports/all</code></li>
                    <li>åç«¯context-pathå¤„ç†: <code>/api/api/ports/all</code> âš ï¸</li>
                    <li>ç»“æœ: <span class="status-error">404 Not Found</span></li>
                </ol>
            </div>
            <div class="after">
                <h4>âœ… æ­£ç¡®çš„è¯·æ±‚æµç¨‹</h4>
                <ol>
                    <li>å‰ç«¯è°ƒç”¨: <code>/ports/all</code></li>
                    <li>æ·»åŠ baseURL: <code>/api/ports/all</code></li>
                    <li>Viteä»£ç†é‡å†™: <code>http://localhost:8080/api + /ports/all</code></li>
                    <li>åç«¯å¤„ç†: <code>/api/ports/all</code> âœ…</li>
                    <li>ç»“æœ: <span class="status-ok">200 OK</span></li>
                </ol>
            </div>
        </div>

        <h2>ğŸ”§ ä¿®å¤æ–¹æ¡ˆ</h2>

        <div class="solution">
            <h3>ä¿®æ”¹Viteä»£ç†é…ç½®</h3>
            <p>ä¿®æ”¹ <code>web/vite.config.js</code> æ–‡ä»¶ï¼Œè°ƒæ•´ä»£ç†é…ç½®ä»¥é¿å…è·¯å¾„é‡å¤ï¼š</p>
        </div>

        <div class="comparison">
            <div class="before">
                <h4>ä¿®å¤å‰</h4>
                <div class="code">proxy: {
  '/api': {
    target: 'http://localhost:8080',
    changeOrigin: true,
    secure: false
  }
}</div>
            </div>
            <div class="after">
                <h4>ä¿®å¤å</h4>
                <div class="code">proxy: {
  '/api': {
    target: 'http://localhost:8080/api',
    changeOrigin: true,
    secure: false,
    rewrite: (path) => path.replace(/^\/api/, '')
  }
}</div>
            </div>
        </div>

        <h3>ä¿®å¤è¦ç‚¹è¯´æ˜</h3>
        <ul>
            <li><strong>targetä¿®æ”¹</strong>: ä» <code>http://localhost:8080</code> æ”¹ä¸º <code>http://localhost:8080/api</code></li>
            <li><strong>æ·»åŠ rewriteè§„åˆ™</strong>: å»æ‰è¯·æ±‚è·¯å¾„ä¸­çš„ <code>/api</code> å‰ç¼€</li>
            <li><strong>ä¿æŒå…¶ä»–é…ç½®ä¸å˜</strong>: changeOriginå’Œsecureç­‰é…ç½®ä¿æŒåŸæ ·</li>
        </ul>

        <h2>ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶</h2>

        <h3>1. æ¸¯å£åœ°å›¾é¡µé¢ (web/src/views/Port/PortMap.vue)</h3>
        <ul>
            <li>âœ… ç§»é™¤ç¡¬ç¼–ç æ¸¯å£æ•°æ®</li>
            <li>âœ… ä½¿ç”¨ <code>getAllPorts()</code> APIè·å–çœŸå®æ•°æ®</li>
            <li>âœ… æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†</li>
            <li>âœ… å­—æ®µæ˜ å°„æ›´æ–° (nameâ†’portName, codeâ†’portCodeç­‰)</li>
        </ul>

        <h3>2. èˆ¹èˆ¶è·Ÿè¸ªé¡µé¢ (web/src/views/Ship/ShipTracking.vue)</h3>
        <ul>
            <li>âœ… ç§»é™¤ç¡¬ç¼–ç èˆ¹èˆ¶æ•°æ®</li>
            <li>âœ… ä½¿ç”¨ <code>getAllShips()</code> APIè·å–çœŸå®æ•°æ®</li>
            <li>âœ… æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†</li>
            <li>âœ… å­—æ®µæ˜ å°„æ›´æ–° (nameâ†’shipName, imoâ†’imoNumberç­‰)</li>
            <li>âœ… ä¸ºæ— ä½ç½®ä¿¡æ¯çš„èˆ¹èˆ¶ç”Ÿæˆæ¨¡æ‹Ÿåæ ‡</li>
        </ul>

        <h3>3. Viteé…ç½® (web/vite.config.js)</h3>
        <ul>
            <li>âœ… ä¿®å¤ä»£ç†é…ç½®ï¼Œé¿å…APIè·¯å¾„é‡å¤</li>
            <li>âœ… æ·»åŠ è·¯å¾„é‡å†™è§„åˆ™</li>
        </ul>

        <h2>ğŸ¯ é¢„æœŸæ•ˆæœ</h2>

        <div class="info">
            <h3>ä¿®å¤åçš„åŠŸèƒ½</h3>
            <ul>
                <li><span class="status-ok">âœ… æ¸¯å£åœ°å›¾</span>: æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„çœŸå®æ¸¯å£æ•°æ®</li>
                <li><span class="status-ok">âœ… èˆ¹èˆ¶è·Ÿè¸ª</span>: æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„çœŸå®èˆ¹èˆ¶æ•°æ®</li>
                <li><span class="status-ok">âœ… åœ°å›¾æ ‡è®°</span>: æ­£ç¡®æ˜¾ç¤ºæ¸¯å£å’Œèˆ¹èˆ¶ä½ç½®</li>
                <li><span class="status-ok">âœ… äº¤äº’åŠŸèƒ½</span>: ç‚¹å‡»å®šä½ã€ä¿¡æ¯å¼¹çª—ç­‰åŠŸèƒ½æ­£å¸¸</li>
                <li><span class="status-ok">âœ… æ•°æ®åŒæ­¥</span>: åœ°å›¾æ•°æ®ä¸æ•°æ®åº“å®æ—¶åŒæ­¥</li>
            </ul>
        </div>

        <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>

        <div class="warning">
            <h3>æ•°æ®åº“çŠ¶æ€</h3>
            <ul>
                <li><strong>æ¸¯å£æ•°æ®</strong>: æ•°æ®åº“ä¸­æœ‰æ¸¯å£æ•°æ®ï¼Œåœ°å›¾åº”æ­£å¸¸æ˜¾ç¤º</li>
                <li><strong>èˆ¹èˆ¶æ•°æ®</strong>: å¦‚æœæ•°æ®åº“ä¸­æš‚æ— èˆ¹èˆ¶æ•°æ®ï¼Œèˆ¹èˆ¶è·Ÿè¸ªåœ°å›¾å¯èƒ½æ˜¾ç¤ºä¸ºç©º</li>
                <li><strong>è§£å†³æ–¹æ¡ˆ</strong>: å¯é€šè¿‡èˆ¹èˆ¶ç®¡ç†é¡µé¢æ·»åŠ èˆ¹èˆ¶æ•°æ®è¿›è¡Œæµ‹è¯•</li>
            </ul>
        </div>

        <h2>ğŸ§ª éªŒè¯æ–¹æ³•</h2>

        <ol>
            <li><strong>é‡å¯æœåŠ¡</strong>: é‡å¯å‰ç«¯å¼€å‘æœåŠ¡ä»¥åº”ç”¨Viteé…ç½®ä¿®æ”¹</li>
            <li><strong>è®¿é—®é¡µé¢</strong>: 
                <ul>
                    <li>æ¸¯å£åœ°å›¾: <code>http://localhost:5173/#/port/map</code></li>
                    <li>èˆ¹èˆ¶è·Ÿè¸ª: <code>http://localhost:5173/#/ship/tracking</code></li>
                </ul>
            </li>
            <li><strong>æ£€æŸ¥æ•°æ®</strong>: ç¡®è®¤åœ°å›¾æ˜¾ç¤ºçš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸€è‡´</li>
            <li><strong>æµ‹è¯•äº¤äº’</strong>: éªŒè¯ç‚¹å‡»å®šä½ã€æœç´¢ç­›é€‰ç­‰åŠŸèƒ½</li>
        </ol>

        <h2>ğŸ‰ æ€»ç»“</h2>

        <div class="solution">
            <p>é€šè¿‡ä¿®å¤Viteä»£ç†é…ç½®ï¼Œè§£å†³äº†APIè·¯å¾„å†²çªé—®é¢˜ï¼Œä½¿æ¸¯å£åœ°å›¾å’Œèˆ¹èˆ¶è·Ÿè¸ªåŠŸèƒ½èƒ½å¤Ÿæ­£ç¡®è·å–å’Œæ˜¾ç¤ºæ•°æ®åº“ä¸­çš„çœŸå®æ•°æ®ã€‚ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨åœ°å›¾ä¸­çœ‹åˆ°ä¸æ•°æ®åº“å®Œå…¨ä¸€è‡´çš„æ¸¯å£å’Œèˆ¹èˆ¶ä¿¡æ¯ã€‚</p>
        </div>

        <div class="info">
            <p><strong>æŠ€æœ¯è¦ç‚¹</strong>: åœ¨å¾®æœåŠ¡æˆ–ä»£ç†ç¯å¢ƒä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„APIè·¯å¾„çš„é…ç½®ï¼Œé¿å…å‰ç«¯ä»£ç†ä¸åç«¯è·¯å¾„å‰ç¼€çš„é‡å¤å¯¼è‡´çš„404é”™è¯¯ã€‚</p>
        </div>
    </div>
</body>
</html> 