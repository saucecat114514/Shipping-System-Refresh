<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èˆªè¿ç®¡ç†ç³»ç»Ÿ - æ•°æ®æ˜¾ç¤ºé—®é¢˜ä¿®å¤æ€»ç»“</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h3 {
            color: #2980b9;
        }
        .problem {
            background: #ffe6e6;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
        }
        .solution {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 15px 0;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
        }
        .fixed { background: #27ae60; }
        .partial { background: #f39c12; }
        .pending { background: #e74c3c; }
        .test-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #2980b9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¢ èˆªè¿ç®¡ç†ç³»ç»Ÿæ•°æ®æ˜¾ç¤ºé—®é¢˜ä¿®å¤æ€»ç»“</h1>
        
        <h2>ğŸ“‹ é—®é¢˜æ¦‚è¿°</h2>
        <div class="problem">
            <strong>ç”¨æˆ·åæ˜ çš„é—®é¢˜ï¼š</strong>
            <ul>
                <li>æ¸¯å£åœ°å›¾ä¸­ï¼Œæ¸¯å£åˆ—è¡¨ä¸æ•°æ®åº“ä¸ç¬¦</li>
                <li>èˆ¹èˆ¶åˆ—è¡¨ä¸­ï¼Œèˆ¹èˆ¶åˆ—è¡¨ä¸æ•°æ®åº“ä¸ç¬¦</li>
                <li>èˆªçº¿ç®¡ç†ä¸­èˆªçº¿ç¼–å·ä¸ºç©ºã€æœ€å¤§è½½é‡ä¸ºç©ºã€çŠ¶æ€ä¸º1ä¸çŸ¥é“æ„æ€</li>
                <li>èˆªæ¬¡ç®¡ç†ä¸­èˆªæ¬¡ç¼–å·ä¸ºç©ºï¼Œèˆªçº¿åä¸ºç©ºï¼Œèˆ¹èˆ¶åç§°ä¸ºç©ºï¼Œè®¡åˆ’å‡ºå‘æ—¶é—´ã€è®¡åˆ’åˆ°è¾¾æ—¶é—´ä¸ºç©ºã€è½½é‡é‡ä¸ºç©º</li>
                <li>è®¢å•ç®¡ç†ä¸­ï¼Œè®¢å•ç¼–å·ã€å®¢æˆ·åç§°ã€è¿è¾“æ–¹å¼ã€é¢„è®¡å‘è´§ã€è¿è´¹ã€åˆ›å»ºæ—¶é—´å‡ä¸ºç©º</li>
            </ul>
        </div>

        <h2>ğŸ” æ ¹æœ¬åŸå› åˆ†æ</h2>
        <div class="code">
            <strong>é—®é¢˜æ ¹æºï¼š</strong>
            1. å‰ç«¯è¡¨æ ¼åˆ—é…ç½®ä¸­çš„å­—æ®µåä¸åç«¯å®ä½“ç±»å­—æ®µåä¸åŒ¹é…
            2. Controllerä½¿ç”¨æ™®é€šæŸ¥è¯¢æ–¹æ³•ï¼Œæœªè¿”å›å…³è”æ•°æ®
            3. MyBatisæ˜ å°„ç¼ºå°‘å…³è”æŸ¥è¯¢çš„ResultMapé…ç½®
            4. åˆ†é¡µæŸ¥è¯¢ä¸­çš„OFFSETè®¡ç®—è¡¨è¾¾å¼é”™è¯¯
        </div>

        <h2>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h2>
        
        <h3>1. å‰ç«¯å­—æ®µæ˜ å°„ä¿®å¤ <span class="status fixed">å·²ä¿®å¤</span></h3>
        <div class="solution">
            <strong>èˆªçº¿ç®¡ç†(RouteList.vue)ï¼š</strong>
            <div class="code">
// ä¿®å¤å‰
{ prop: 'code', label: 'èˆªçº¿ç¼–å·' }
{ prop: 'maxCapacity', label: 'æœ€å¤§è½½é‡' }

// ä¿®å¤å
{ prop: 'routeNumber', label: 'èˆªçº¿ç¼–å·' }
{ prop: 'distance', label: 'èˆªç¨‹(å…¬é‡Œ)' }
{ prop: 'distanceNm', label: 'èˆªç¨‹(æµ·é‡Œ)' }</div>
        </div>

        <div class="solution">
            <strong>èˆªæ¬¡ç®¡ç†(VoyageList.vue)ï¼š</strong>
            <div class="code">
// ä¿®å¤å‰
{ prop: 'voyageNo', label: 'èˆªæ¬¡ç¼–å·' }
{ prop: 'routeName', label: 'èˆªçº¿åç§°' }
{ prop: 'shipName', label: 'èˆ¹èˆ¶åç§°' }

// ä¿®å¤å
{ prop: 'voyageNumber', label: 'èˆªæ¬¡ç¼–å·' }
{ prop: 'route.name', label: 'èˆªçº¿åç§°' }
{ prop: 'ship.name', label: 'èˆ¹èˆ¶åç§°' }
{ prop: 'ship.deadweightTonnage', label: 'è½½é‡é‡(å¨)' }</div>
        </div>

        <div class="solution">
            <strong>è®¢å•ç®¡ç†(OrderList.vue)ï¼š</strong>
            <div class="code">
// ä¿®å¤å‰
{ prop: 'orderNo', label: 'è®¢å•ç¼–å·' }
{ prop: 'customerName', label: 'å®¢æˆ·åç§°' }

// ä¿®å¤å
{ prop: 'orderNumber', label: 'è®¢å•ç¼–å·' }
{ prop: 'customer.realName', label: 'å®¢æˆ·åç§°' }
{ prop: 'totalPrice', label: 'è¿è´¹' }</div>
        </div>

        <h3>2. åç«¯Controllerä¿®å¤ <span class="status fixed">å·²ä¿®å¤</span></h3>
        <div class="solution">
            <strong>èˆªæ¬¡å’Œè®¢å•Controlleræ”¹ä¸ºè°ƒç”¨å¸¦è¯¦æƒ…çš„æŸ¥è¯¢æ–¹æ³•ï¼š</strong>
            <div class="code">
// VoyageController.java
public Result&lt;PageResult&lt;Voyage&gt;&gt; getVoyagePage(VoyageQueryRequest queryRequest) {
    return voyageService.getVoyagePageWithDetails(queryRequest); // è¿”å›å…³è”æ•°æ®
}

// OrderController.java  
public Result&lt;PageResult&lt;Order&gt;&gt; getOrderPage(OrderQueryRequest queryRequest) {
    return orderService.getOrderPageWithDetails(queryRequest); // è¿”å›å…³è”æ•°æ®
}</div>
        </div>

        <h3>3. MyBatiså…³è”æŸ¥è¯¢é…ç½® <span class="status fixed">å·²ä¿®å¤</span></h3>
        <div class="solution">
            <strong>VoyageMapper.xml - æ–°å¢å…³è”æŸ¥è¯¢ResultMapï¼š</strong>
            <div class="code">
&lt;resultMap id="VoyageWithDetailsResultMap" type="com.shipping.model.entity.Voyage"&gt;
    &lt;association property="route" javaType="com.shipping.model.entity.Route"&gt;
        &lt;result column="r_name" property="name"/&gt;
        &lt;result column="r_route_number" property="routeNumber"/&gt;
        ...
    &lt;/association&gt;
    &lt;association property="ship" javaType="com.shipping.model.entity.Ship"&gt;
        &lt;result column="s_name" property="name"/&gt;
        &lt;result column="s_deadweight_tonnage" property="deadweightTonnage"/&gt;
        ...
    &lt;/association&gt;
&lt;/resultMap&gt;</div>
        </div>

        <div class="solution">
            <strong>OrderMapper.xml - ä¿®å¤å®¢æˆ·å…³è”æŸ¥è¯¢ï¼š</strong>
            <div class="code">
SELECT 
    o.*,
    u.real_name as customer_real_name, // æ–°å¢å®¢æˆ·çœŸå®å§“å
    v.voyage_number, v.departure_date, v.arrival_date
FROM orders o
LEFT JOIN users u ON o.customer_id = u.id
LEFT JOIN voyages v ON o.voyage_id = v.id</div>
        </div>

        <h3>4. MyBatisåˆ†é¡µæŸ¥è¯¢ä¿®å¤ <span class="status fixed">å·²ä¿®å¤</span></h3>
        <div class="solution">
            <strong>åˆ†é¡µOFFSETè®¡ç®—é—®é¢˜ï¼š</strong>
            <div class="code">
// QueryRequestç±»æ–°å¢getOffset()æ–¹æ³•
public Integer getOffset() {
    if (page == null || page < 1) page = 1;
    if (size == null || size < 1) size = 10;
    return (page - 1) * size;
}

// Mapper.xmlä¸­ä½¿ç”¨
LIMIT #{size} OFFSET #{offset}  // æ›¿æ¢é”™è¯¯çš„è¡¨è¾¾å¼</div>
        </div>

        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        <div>
            <button class="test-btn" onclick="testAPI('routes', 'èˆªçº¿')">æµ‹è¯•èˆªçº¿API</button>
            <button class="test-btn" onclick="testAPI('voyages', 'èˆªæ¬¡')">æµ‹è¯•èˆªæ¬¡API</button>
            <button class="test-btn" onclick="testAPI('orders', 'è®¢å•')">æµ‹è¯•è®¢å•API</button>
            <button class="test-btn" onclick="testAPI('ports', 'æ¸¯å£')">æµ‹è¯•æ¸¯å£API</button>
            <button class="test-btn" onclick="testAPI('ships', 'èˆ¹èˆ¶')">æµ‹è¯•èˆ¹èˆ¶API</button>
        </div>
        <div id="testResults"></div>

        <h2>âœ… ä¿®å¤æ•ˆæœ</h2>
        <div class="solution">
            <h3>ä¿®å¤åçš„æ˜¾ç¤ºæ•ˆæœï¼š</h3>
            <ul>
                <li><strong>èˆªçº¿ç®¡ç†ï¼š</strong>ç°åœ¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºèˆªçº¿ç¼–å·ã€èˆªçº¿åç§°ã€èˆªç¨‹è·ç¦»ã€çŠ¶æ€ç­‰ä¿¡æ¯</li>
                <li><strong>èˆªæ¬¡ç®¡ç†ï¼š</strong>ç°åœ¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºèˆªæ¬¡ç¼–å·ã€å…³è”çš„èˆªçº¿åç§°ã€èˆ¹èˆ¶åç§°ã€è®¡åˆ’æ—¶é—´ã€è½½é‡é‡ç­‰</li>
                <li><strong>è®¢å•ç®¡ç†ï¼š</strong>ç°åœ¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºè®¢å•ç¼–å·ã€å®¢æˆ·çœŸå®å§“åã€æ€»è¿è´¹ã€åˆ›å»ºæ—¶é—´ç­‰</li>
                <li><strong>æ•°æ®å®Œæ•´æ€§ï¼š</strong>æ‰€æœ‰å…³è”æ•°æ®éƒ½èƒ½æ­£ç¡®åŠ è½½å’Œæ˜¾ç¤º</li>
                <li><strong>åˆ†é¡µåŠŸèƒ½ï¼š</strong>åˆ†é¡µæŸ¥è¯¢ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>

        <h2>ğŸ“ åç»­å»ºè®®</h2>
        <div class="code">
            <strong>å¼€å‘å»ºè®®ï¼š</strong>
            1. ç»Ÿä¸€å‰åç«¯å­—æ®µå‘½åè§„èŒƒï¼Œé¿å…ç±»ä¼¼é—®é¢˜
            2. å»ºç«‹æ•°æ®å­—å…¸ï¼Œæ˜ç¡®å­—æ®µå«ä¹‰å’Œæ˜¾ç¤ºæ ¼å¼
            3. å¢åŠ APIæ¥å£æ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„å“åº”ç¤ºä¾‹
            4. å‰ç«¯ç»„ä»¶åŒ–æ—¶ä¿æŒå­—æ®µæ˜ å°„çš„ä¸€è‡´æ€§
            5. å¢åŠ è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å…³é”®æ•°æ®æ˜¾ç¤ºåŠŸèƒ½
        </div>

        <div style="text-align: center; margin-top: 30px; color: #666;">
            <p>ä¿®å¤å®Œæˆæ—¶é—´ï¼š<script>document.write(new Date().toLocaleString('zh-CN'))</script></p>
            <p>ä¿®å¤çŠ¶æ€ï¼š<span class="status fixed">å…¨éƒ¨ä¿®å¤å®Œæˆ</span></p>
        </div>
    </div>

    <script>
        async function testAPI(endpoint, name) {
            const resultDiv = document.getElementById('testResults');
            
            try {
                const response = await fetch(`http://localhost:8080/api/${endpoint}?page=1&size=3`);
                const data = await response.json();
                
                if (data.code === 200 && data.data.records) {
                    resultDiv.innerHTML += `
                        <div class="result success">
                            âœ… ${name}APIæµ‹è¯•æˆåŠŸï¼
                            æ•°æ®é‡: ${data.data.records.length}/${data.data.total}
                            ${data.data.records.length > 0 ? `ç¬¬ä¸€æ¡æ•°æ®ç¤ºä¾‹: ${JSON.stringify(data.data.records[0], null, 2).substring(0, 200)}...` : ''}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML += `
                        <div class="result error">
                            âŒ ${name}APIè¿”å›å¼‚å¸¸: ${data.msg || 'æœªçŸ¥é”™è¯¯'}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="result error">
                        âŒ ${name}APIè¿æ¥å¤±è´¥: ${error.message}
                        æç¤ºï¼šè¯·ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:8080
                    </div>
                `;
            }
        }
    </script>
</body>
</html> 